// Generated by CoffeeScript 1.7.1
(function() {
  window.Timer = (function() {
    function Timer() {
      var positions, _this;
      this.digit_to_name = "zero one two three four five six seven eight nine".split(" ");
      this.digits = {};
      this.start = moment();
      this.stop = false;
      _this = this;
      positions = ["s1", "s2"];
      $.each(positions, function() {
        var i, pos, _i;
        pos = $("<div>");
        for (i = _i = 0; _i < 8; i = ++_i) {
          pos.append("<span class='d" + i + "'>");
        }
        _this.digits[this] = pos;
        return $("#timer").append(pos);
      });
    }

    Timer.prototype.startTimer = function() {
      $("#timer").show();
      this.stop = false;
      this.start = moment();
      return setTimeout((function(_this) {
        return function() {
          return _this.updateTime();
        };
      })(this), 0);
    };

    Timer.prototype.stopTimer = function() {
      return this.stop = true;
    };

    Timer.prototype.timeOut = function() {
      $(window).trigger("time_out");
      this.stopTimer();
      return this.startTimer();
    };

    Timer.prototype.updateTime = function() {
      var sec;
      sec = 60 - ((moment() - this.start) / 1000 | 0);
      this.digits.s1.attr("class", this.digit_to_name[sec / 10 | 0]);
      this.digits.s2.attr("class", this.digit_to_name[sec % 10]);
      if (sec < 2) {
        this.timeOut();
      }
      if (!this.stop) {
        return setTimeout((function(_this) {
          return function() {
            return _this.updateTime();
          };
        })(this), 1000);
      }
    };

    return Timer;

  })();

}).call(this);
